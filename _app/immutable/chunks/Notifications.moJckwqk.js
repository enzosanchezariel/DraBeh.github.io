import{a as s,t as f}from"./disclose-version.CLVP8wdO.js";import{p as $,k as c,m as q,a as H,s as p,i as t,j as o,c as i,t as U,r as n}from"./runtime.OFQIcp2P.js";import{s as j}from"./render.BVhLVIDF.js";import{i as _}from"./if.CxsERAfj.js";import{e as J,i as Q}from"./each._uhWAVV4.js";import{s as V}from"./attributes.CGWwtoYz.js";import{p as B}from"./proxy.B9U5D_Zu.js";import{b as W}from"./this.DL9b0rlM.js";import{o as X}from"./index-client.DzRFANZT.js";import{b as Y}from"./paths.BwddfpLl.js";import{P as R}from"./public.CHZCeYTi.js";import{i as Z,j as T}from"./jwtRetriever.svelte.eYKYCOXx.js";import{s as z}from"./shared.svelte.Crem28hc.js";var tt=f('<div><a aria-label="Notification link" class="svelte-1nl07fl"><div class="notif svelte-1nl07fl"><strong> </strong> <p class="svelte-1nl07fl"> </p></div></a></div>'),et=f("<p>Loading...</p>"),at=f("<p>Reached end</p>"),ot=f("<p>Failed to load notifications</p>"),rt=f("<p>No notifications</p>"),st=f('<div class="notifications svelte-1nl07fl"><!> <!> <!> <!> <!></div>');function bt(E,O){$(O,!0);let r=c(B([])),N=0,l=c(!1),d=c(!1),v=c(!1),m;async function P(){try{(await fetch(R+"/notifications/mark-read",{method:"POST",headers:{Authorization:"Bearer "+T()}})).status===200&&z.cachedUserData&&(z.cachedUserData.lastNotificationsSeenAt=new Date().toISOString())}catch{}}async function w(){if(!(t(l)||t(d))){o(l,!0),o(v,!1);try{const e=await fetch(R+`/notifications?page=${N}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+T()}}),a=await e.json();e.status!==200?o(v,!0):(a.length!==0?(o(r,B([...t(r),...a])),N+=1):o(d,!0),P())}catch{o(v,!0)}o(l,!1)}}let u=c(void 0);function D(){m&&m.disconnect(),t(r).length>0&&t(u)&&(m=new IntersectionObserver(e=>{e[0].isIntersecting&&w()}),m.observe(t(u)))}q(()=>{D()}),X(()=>{Z()&&(D(),w())});function C(e){return new Intl.DateTimeFormat("en-US",{dateStyle:"short",timeStyle:"short"}).format(new Date(e))}var g=st(),x=i(g);J(x,17,()=>t(r),Q,(e,a)=>{var h=tt(),b=i(h),A=i(b),I=i(A),M=i(I,!0);U(()=>j(M,C(t(a).creationDateTime))),n(I);var L=p(I,2),G=i(L,!0);n(L),n(A),n(b),n(h),W(h,K=>o(u,K),()=>t(u)),U(()=>{V(b,"href",Y+(t(a).postId!==null?"/home/post?postId="+t(a).postId:t(a).userInvolved!==null?"/home/user?userId="+t(a).userInvolved:"#")),j(G,t(a).text)}),s(e,h)});var y=p(x,2);_(y,()=>t(l),e=>{var a=et();s(e,a)});var S=p(y,2);_(S,()=>t(d)&&t(r).length!==0,e=>{var a=at();s(e,a)});var k=p(S,2);_(k,()=>t(v),e=>{var a=ot();s(e,a)});var F=p(k,2);_(F,()=>!t(l)&&t(d)&&t(r).length===0,e=>{var a=rt();s(e,a)}),n(g),s(E,g),H()}export{bt as N};
