import{a as u,t as _}from"../chunks/disclose-version.CLVP8wdO.js";import{h as ne,p as we,k as f,m as ke,g as G,a as be,j as s,i as e,s as o,c as d,r as v,t as ce}from"../chunks/runtime.OFQIcp2P.js";import{d as xe,s as U}from"../chunks/render.BVhLVIDF.js";import{i as x}from"../chunks/if.CxsERAfj.js";import{e as ye,i as Ie}from"../chunks/each._uhWAVV4.js";import{s as g}from"../chunks/style.PwPRnE0L.js";import{p as h}from"../chunks/proxy.B9U5D_Zu.js";import{o as Ne}from"../chunks/index-client.DzRFANZT.js";import{o as Ue,g as y}from"../chunks/entry.DMoyRBBC.js";import{P as q}from"../chunks/public.CHZCeYTi.js";import{L as Pe,F as Re}from"../chunks/FeedPost.C_lPGEKA.js";import{i as M,c as Le,j as H}from"../chunks/jwtRetriever.svelte.eYKYCOXx.js";import{s as J}from"../chunks/shared.svelte.Crem28hc.js";import{b as I}from"../chunks/paths.CWjIHuvM.js";function de(i,p){var n=i.__className,a=Se(p);ne&&i.className===a?i.__className=a:(n!==a||ne&&i.className!==a)&&(p==null?i.removeAttribute("class"):i.className=a,i.__className=a)}function Se(i){return i??""}async function Te(i,p,n,a){if(!e(p))return;s(n,!0),s(a,!e(a));const P={followed:e(a),userId:e(p).id};try{(await fetch(q+"/user/follow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+H()},body:JSON.stringify(P)})).ok?e(a)?e(p).followers+=1:e(p).followers-=1:s(a,!e(a))}catch{s(a,!e(a))}s(n,!1)}var De=_("<button> </button>"),Ee=(i,p)=>{M()?y(I+"/home/report?reported="+e(p)):y(I+"/account/login")},Me=_('<h1 class="svelte-45h5dk"> </h1> <div class="sbs svelte-45h5dk"><div class="lottie svelte-45h5dk"><!></div> <div class="user-details svelte-45h5dk"><div class="user-datetime svelte-45h5dk"><strong class="svelte-45h5dk"> </strong> <p class="svelte-45h5dk">&bull;</p> <p class="svelte-45h5dk"> </p></div> <p class="svelte-45h5dk"> </p> <div></div> <div class="sbs svelte-45h5dk"><div><p class="svelte-45h5dk"> </p></div> <div></div> <!> <button class="report-btn svelte-45h5dk" aria-label="Report user"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 14h14l-4.5 -4.5l4.5 -4.5h-14v16"></path></svg></button></div></div></div>',1),je=_("<p>In response to another post</p>"),Be=_("<!> <!>",1),Ce=_("<p>Loading...</p>"),Oe=_("<p>Reached end</p>"),Ae=_("<p>Failed to load posts</p>"),Fe=_("<p>This user didn't post anything</p>"),ze=_("<!> <hr> <!> <!> <!> <!> <!>",1);function at(i,p){we(p,!0);let n=f(void 0),a=f(h([])),P=0,m=f(!1),R=f(!1),L=f(!1),T;async function j(){if(console.log("loadMore"),!(e(m)||e(R)||!M())){s(m,!0),s(L,!1);try{const t=await fetch(q+"/posts/"+e(n)+`?page=${P}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+H()}});if(t.status!==200)s(L,!0);else{const r=await t.json();r.length!==0?(s(a,h([...e(a),...r])),P+=1):s(R,!0)}}catch{s(L,!0)}s(m,!1)}}function B(){if(T&&T.disconnect(),e(a).length>0){const t=document.querySelector(".post:last-child");t&&(T=new IntersectionObserver(r=>{r[0].isIntersecting&&j()}),T.observe(t))}}Ue(t=>{var c,w;if(((c=t.to)==null?void 0:c.route.id)!=="/home/user"||((w=t.from)==null?void 0:w.route.id)!=="/home/user")return;const r=new URLSearchParams(window.location.search);s(n,h(r.get("userId"))),e(n)?(s(a,h([])),P=0,s(m,!1),s(R,!1),s(L,!1),s(l,null),s(C,null),M()||y(I+"/account/login",{replaceState:!0}),j(),B(),W()):y(I+"/home")}),Ne(()=>{const t=new URLSearchParams(window.location.search);s(n,h(t.get("userId"))),e(n)?(M()||y(I+"/account/login",{replaceState:!0}),j(),B(),W(),J.cachedUserData===null&&Le()):y(I+"/home")}),ke(()=>{B()});let l=f(null),C=f(null),K=f("chip chip-default");async function W(){var c;const t=await fetch(q+"/user-info/"+e(n),{method:"GET",headers:{Authorization:"Bearer "+H()}}),r=await t.json();t.ok&&(s(l,h(r)),s(K,h(e(l)&&(e(l).role==="OWNER"||e(l).role==="MODERATOR")?"chip chip-blue":e(l)&&e(l).role==="MEMBER"?"chip chip-yellow":"chip chip-default")),s(C,h(new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(r.creationDateTime))),s(D,h(((c=e(l))==null?void 0:c.followed)??!1)))}let D=f(!1),Q=f(!1);var V=ze(),X=G(V);x(X,()=>e(l),t=>{var r=Me(),c=G(r),w=d(c,!0);v(c);var S=o(c,2);g(S,"gap","1rem");var k=d(S),b=d(k);Pe(b,{emoteId:"0",get avatarId(){return e(l).avatarId}}),v(k);var O=o(k,2);g(O,"flex-grow","1");var A=d(O),F=d(A),pe=d(F,!0);v(F);var z=o(F,2);g(z,"color","grey"),g(z,"flex-grow","0");var ae=o(z,2),fe=d(ae);v(ae),v(A);var $=o(A,2),he=d($);v($);var se=o($,2);g(se,"flex-grow","1");var re=o(se,2),E=d(re),oe=d(E),ue=d(oe,!0);v(oe),v(E);var le=o(E,2);g(le,"flex-grow","1");var ie=o(le,2);x(ie,()=>J.cachedUserData&&J.cachedUserData.id!==Number(e(n)),me=>{var N=De();N.__click=[Te,l,Q,D];var ge=d(N,!0);v(N),ce(()=>{de(N,`${(e(D)?"follow-btn unfollow-btn":"follow-btn")??""} svelte-45h5dk`),N.disabled=e(Q),U(ge,e(D)?"Unfollow":"Follow")}),u(me,N)});var _e=o(ie,2);_e.__click=[Ee,n],v(re),v(O),v(S),ce(()=>{U(w,e(l).nickname),U(pe,e(l).username),U(fe,`Joined ${e(C)??""}`),U(he,`followers: ${e(l).followers??""}`),de(E,`${e(K)??""} svelte-45h5dk`),U(ue,e(l).role)}),u(t,r)});var Y=o(X,4);ye(Y,17,()=>e(a),Ie,(t,r)=>{var c=Be(),w=G(c);x(w,()=>e(r).post.replyTo,k=>{var b=je();g(b,"margin","5px 0"),g(b,"color","grey"),u(k,b)});var S=o(w,2);Re(S,{get post(){return e(r)},redirectOnClick:"true",replied:()=>{y(I+"/home/post?postId="+e(r).post.id)},ondelete:k=>{s(a,h(e(a).filter(b=>b.post.id!==k)))}}),u(t,c)});var Z=o(Y,2);x(Z,()=>e(m),t=>{var r=Ce();u(t,r)});var ee=o(Z,2);x(ee,()=>e(R)&&e(a).length!==0,t=>{var r=Oe();u(t,r)});var te=o(ee,2);x(te,()=>e(L),t=>{var r=Ae();u(t,r)});var ve=o(te,2);x(ve,()=>!e(m)&&e(R)&&e(a).length===0,t=>{var r=Fe();u(t,r)}),u(i,V),be()}xe(["click"]);export{at as component};
