import{c as R,a as f,t as A}from"../chunks/disclose-version.D9m7xwQo.js";import{p as Z,f as V,a as $,j as t,i as e,s as o,c as v,t as ee,k as l,r as d}from"../chunks/runtime.DfkX_MRI.js";import{d as te,e as q}from"../chunks/render.C_RUzaBA.js";import{i as _}from"../chunks/if.Che8I7_Z.js";import{r as F}from"../chunks/attributes.Dy5-VJ7D.js";import{t as k,f as j,s as G}from"../chunks/index.BZ_PEADJ.js";import{b as H}from"../chunks/input.DziYSjDK.js";import{p as w}from"../chunks/proxy.DjRACbVb.js";import{o as ae}from"../chunks/index-client.D7pkVx_0.js";import{g as I}from"../chunks/entry.BIT9139B.js";import{b as L}from"../chunks/paths.DkE6e-OB.js";import{P as J}from"../chunks/public.CuSQJZaf.js";import{E as re}from"../chunks/ErrorArticle.DqpzrGdp.js";import{i as oe,j as K,l as se}from"../chunks/jwtRetriever.svelte.DgyyIg0v.js";var ne=A('<p class="svelte-vevk28">How you want to be called</p>'),ie=A('<p class="svelte-vevk28">Unique to identify your account (cannot contain spaces)</p>'),le=A('<article><strong>Change names</strong> <footer><form><div class="tip svelte-vevk28"><label for="nickname">Nickname</label> <input type="text" id="nickname" name="nickname" required class="svelte-vevk28"> <!></div> <div class="tip svelte-vevk28"><label for="username">Username</label> <input type="text" id="username" name="username" required class="svelte-vevk28"> <!></div> <button type="submit">Save changes</button></form> <!></footer></article>'),ce=A("<p>You will have to log back in for security purposes.</p>"),ue=(N,D,c)=>{e(D)!==e(c)?I(L+"/account/login"):I(L+"/account/settings")},me=A('<article><strong>Changes applied</strong> <footer><p>Changes applied successfully.</p> <!> <button type="submit">Accept</button></footer></article>');function Se(N,D){Z(D,!0);let c=l(!1),C=l(""),E=l(!1),U=l(-1),B=l(0);function P(r){t(U,w(r))}let u=l(""),b=l("");ae(()=>{oe()||I(L+"/account/login",{replaceState:!0}),Y()});async function M(r){t(E,!0),r.preventDefault();const a=new FormData(r.target),m={username:a.get("username"),nickname:a.get("nickname")};try{const s=await fetch(J+"/modify-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+K()},body:JSON.stringify(m)});s.ok?(t(c,!1),m.username!==e(y)&&se(),t(B,1)):s.status===409?(t(C,"The username is already taken."),t(c,!0)):(t(C,"An error occurred."),t(c,!0))}catch{t(C,"Couldn't connect to the server."),t(c,!0)}t(E,!1)}let y=l(""),z=l("");async function Y(){const r=await fetch(J+"/private-user-info",{method:"GET",headers:{Authorization:"Bearer "+K()}}),a=await r.json();r.ok&&(t(y,w(a.username)),t(z,w(a.nickname)),t(u,w(a.username)),t(b,w(a.nickname)))}var O=R(),Q=V(O);_(Q,()=>e(B)===0,r=>{var a=le(),m=o(v(a),2),s=v(m),n=v(s),p=o(v(n),2);F(p);var S=o(p,2);_(S,()=>e(U)===0,i=>{var x=ne();k(3,x,()=>G,()=>({axis:"y",duration:500})),f(i,x)}),d(n);var h=o(n,2),g=o(v(h),2);F(g);var T=o(g,2);_(T,()=>e(U)===1,i=>{var x=ie();k(3,x,()=>G,()=>({axis:"y",duration:500})),f(i,x)}),d(h);var W=o(h,2);ee(()=>W.disabled=e(E)||e(u)===""||e(u).includes(" ")||e(b)===""||e(u)===e(y)&&e(b)===e(z)),d(s);var X=o(s,2);_(X,()=>e(c),i=>{re(i,{get text(){return e(C)},removeAction:()=>{t(c,!1)}})}),d(m),d(a),q("submit",s,M),q("focus",p,()=>P(0)),H(p,()=>e(b),i=>t(b,i)),q("focus",g,()=>P(1)),H(g,()=>e(u),i=>t(u,i)),k(1,a,()=>j,()=>({x:1e3,duration:500,delay:500})),k(2,a,()=>j,()=>({x:-1e3,duration:500})),f(r,a)},r=>{var a=R(),m=V(a);_(m,()=>e(B)===1,s=>{var n=me(),p=o(v(n),2),S=o(v(p),2);_(S,()=>e(u)!==e(y),g=>{var T=ce();f(g,T)});var h=o(S,2);h.__click=[ue,u,y],d(p),d(n),k(1,n,()=>j,()=>({x:1e3,duration:500,delay:500})),k(2,n,()=>j,()=>({x:-1e3,duration:500})),f(s,n)},null,!0),f(r,a)}),f(N,O),$()}te(["click"]);export{Se as component};
