import{c as G,a,t as i}from"../chunks/disclose-version.7XzoFcgQ.js";import{p as Y,k as f,m as Z,f as u,a as ee,i as e,j as t,s as h,l as te,c as oe,r as re}from"../chunks/runtime.CcS7PSai.js";import{i as d}from"../chunks/if.Bc-vB0Lk.js";import{e as ae,i as se}from"../chunks/each.BmzqR-dK.js";import{p as v}from"../chunks/proxy.DTRB1kLB.js";import{s as ne,a as ie}from"../chunks/store.BcBN-cJU.js";import{P as O}from"../chunks/public.CuSQJZaf.js";import{F as U}from"../chunks/FeedPost.D0VN_9si.js";import{o as le}from"../chunks/index-client.DhXnJF1D.js";import{p as pe}from"../chunks/stores.JmGfupFY.js";import{o as me,g as k}from"../chunks/entry.CftrLipe.js";import{i as S,j as H}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";var fe=i("<p>Post not found</p>"),de=i("<p>Loading post...</p>"),ce=i("<p>Failed to load post</p>"),ue=i('<h3>Replying to</h3> <!> <div class="vertical-line svelte-10uk3rb"></div>',1),ve=i("<!> <!>",1),_e=i('<div class="comment"><!></div>'),ge=i("<p>No comments</p>"),he=i("<hr> <h3>Comments</h3> <!> <!>",1),ye=i("<p>Loading comments...</p>"),we=i("<p>Failed to load comments</p>"),Ce=i("<!> <!> <!>",1);function ze(J,Q){Y(Q,!0);const V=ne();let E=ie(pe,"$page",V).params.id,l=f(v([])),N=0,y=f(!1),R=f(!1),w=f(!1);async function z(){if(console.log("loadMore"),!(e(y)||e(R))){t(y,!0),t(w,!1);try{const o=await fetch(O+"/posts/comments/"+E+`?page=${N}&size=5`,{method:"GET",headers:S()?{Authorization:"Bearer "+H()}:{}}),r=await o.json();o.status!==200?t(w,!0):r.length!==0?(t(l,v([...e(l),...r])),N+=1):t(R,!0)}catch{t(w,!0)}t(y,!1)}}let $;function A(){if($&&$.disconnect(),e(l).length>0){const o=document.querySelector(".comment:last-child");o&&($=new IntersectionObserver(r=>{r[0].isIntersecting&&z()}),$.observe(o))}}le(()=>{q(),e(I)||(z(),A())}),me(o=>{var r,P,L,x;((r=o.to)==null?void 0:r.route.id)!=="/home/post/[id]"||((P=o.from)==null?void 0:P.route.id)!=="/home/post/[id]"||(console.log(o),E=((x=(L=o.to)==null?void 0:L.params)==null?void 0:x.id)??"-1",t(s,null),t(b,null),t(C,!1),t(F,!1),t(l,v([])),N=0,t(y,!1),t(R,!1),t(w,!1),q(),e(I)||(z(),A()))}),Z(()=>{A()});let F=f(!0),C=f(!1),I=f(!1),s=f(null),b=f(null);async function q(){t(F,!0),t(C,!1);try{const o=await fetch(O+"/post/"+E,{method:"GET",headers:S()?{Authorization:"Bearer "+H()}:{}});o.status!==200?(t(C,!0),o.status===404&&t(I,!0)):t(s,v(await o.json()))}catch{t(C,!0)}t(F,!1),e(s)&&e(s).post.replyTo&&t(b,v(await D(e(s).post.replyTo)))}async function W(o){const r=await D(o);r&&t(l,v([r,...e(l)]))}async function D(o){const r=await fetch(O+"/post/"+o);return r.status===200?r.json():null}var K=G(),X=u(K);d(X,()=>e(I),o=>{var r=fe();a(o,r)},o=>{var r=Ce(),P=u(r);d(P,()=>e(F),m=>{var n=de();a(m,n)},m=>{var n=G(),_=u(n);d(_,()=>e(C)||e(s)===null,c=>{var p=ce();a(c,p)},c=>{var p=ve(),g=u(p);d(g,()=>e(s).post.replyTo&&e(b),j=>{var B=ue(),M=h(u(B),2);U(M,{get post(){return e(b)},redirectOnClick:"true",replied:()=>{e(s)&&e(s).post.replyTo&&k("/home/post/"+e(s).post.replyTo)},ondelete:()=>{k("/home")}}),te(2),a(j,B)});var T=h(g,2);U(T,{get post(){return e(s)},replied:j=>{W(j)},ondelete:()=>{k("/home")}}),a(c,p)},!0),a(m,n)});var L=h(P,2);d(L,()=>e(s)&&e(s).post.replyTo===null,m=>{var n=he(),_=h(u(n),4);ae(_,17,()=>e(l),se,(p,g)=>{var T=_e(),j=oe(T);U(j,{get post(){return e(g)},ondelete:B=>{t(l,v(e(l).filter(M=>M.post.id!==B)))}}),re(T),a(p,T)});var c=h(_,2);d(c,()=>e(l).length===0,p=>{var g=ge();a(p,g)}),a(m,n)});var x=h(L,2);d(x,()=>e(y),m=>{var n=ye();a(m,n)},m=>{var n=G(),_=u(n);d(_,()=>e(w),c=>{var p=we();a(c,p)},null,!0),a(m,n)}),a(o,r)}),a(J,K),ee()}export{ze as component};
