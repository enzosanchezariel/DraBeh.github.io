import{a as f,t as _}from"../chunks/disclose-version.D9m7xwQo.js";import{h as ce,p as we,k as u,m as xe,f as q,a as ye,j as r,i as e,s as o,c as p,r as c,t as ve}from"../chunks/runtime.DfkX_MRI.js";import{d as ke,s as $}from"../chunks/render.C_RUzaBA.js";import{i as x}from"../chunks/if.Che8I7_Z.js";import{e as Ie,i as Ne}from"../chunks/each.CjdCHN41.js";import{s as y}from"../chunks/style.PwPRnE0L.js";import{p as h}from"../chunks/proxy.DjRACbVb.js";import{s as $e,a as Me}from"../chunks/store.F8uOMCsi.js";import{o as Te,g as U}from"../chunks/entry.BIT9139B.js";import{P as J}from"../chunks/public.CuSQJZaf.js";import{L as Ue,F as De}from"../chunks/FeedPost.Dc5HT2eE.js";import{p as Ee}from"../chunks/stores.DGAcSa27.js";import{o as Pe}from"../chunks/index-client.D7pkVx_0.js";import{i as B,c as Re,j as K}from"../chunks/jwtRetriever.svelte.DgyyIg0v.js";import{s as H}from"../chunks/shared.svelte.BeaxiWn1.js";import{b as D}from"../chunks/paths.DkE6e-OB.js";function de(l,d){var k=l.__className,a=Be(d);ce&&l.className===a?l.__className=a:(k!==a||ce&&l.className!==a)&&(d==null?l.removeAttribute("class"):l.className=a,l.__className=a)}function Be(l){return l??""}async function Ce(l,d,k,a){if(!e(d))return;r(k,!0),r(a,!e(a));const g={followed:e(a),userId:e(d).id};try{(await fetch(J+"/user/follow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+K()},body:JSON.stringify(g)})).ok?e(a)?e(d).followers+=1:e(d).followers-=1:r(a,!e(a))}catch{r(a,!e(a))}r(k,!1)}var Le=_("<button> </button>"),Oe=_('<h1> </h1> <div class="sbs svelte-1jj7ebj"><div class="lottie svelte-1jj7ebj"><!></div> <div class="user-details svelte-1jj7ebj"><div class="user-datetime svelte-1jj7ebj"><strong> </strong> <p class="svelte-1jj7ebj">&bull;</p> <p class="svelte-1jj7ebj"> </p></div> <p class="svelte-1jj7ebj"> </p> <div></div> <div class="sbs svelte-1jj7ebj"><div><p class="svelte-1jj7ebj"> </p></div> <div></div> <!> <button class="report-btn svelte-1jj7ebj" aria-label="Report user"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 14h14l-4.5 -4.5l4.5 -4.5h-14v16"></path></svg></button></div></div></div>',1),Se=_("<p>In response to another post</p>"),Ae=_("<!> <!>",1),Fe=_("<p>Loading...</p>"),ze=_("<p>Reached end</p>"),Ge=_("<p>Failed to load posts</p>"),qe=_("<p>This user didn't post anything</p>"),He=_("<!> <hr> <!> <!> <!> <!> <!>",1);function nt(l,d){we(d,!0);const k=$e();let g=Me(Ee,"$page",k).params.id,v=u(h([])),C=0,I=u(!1),M=u(!1),T=u(!1),E;async function L(){if(console.log("loadMore"),!(e(I)||e(M)||!B())){r(I,!0),r(T,!1);try{const t=await fetch(J+"/posts/"+g+`?page=${C}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+K()}});if(t.status!==200)r(T,!0);else{const s=await t.json();s.length!==0?(r(v,h([...e(v),...s])),C+=1):r(M,!0)}}catch{r(T,!0)}r(I,!1)}}function O(){if(E&&E.disconnect(),e(v).length>0){const t=document.querySelector(".post:last-child");t&&(E=new IntersectionObserver(s=>{s[0].isIntersecting&&L()}),E.observe(t))}}Te(t=>{var s,n,j,m;((s=t.to)==null?void 0:s.route.id)!=="/home/user/[id]"||((n=t.from)==null?void 0:n.route.id)!=="/home/user/[id]"||(g=((m=(j=t.to)==null?void 0:j.params)==null?void 0:m.id)??"-1",r(v,h([])),C=0,r(I,!1),r(M,!1),r(T,!1),r(i,null),r(S,null),B()||U(D+"/account/login",{replaceState:!0}),L(),O(),Q())}),Pe(()=>{B()||U(D+"/account/login",{replaceState:!0}),L(),O(),Q(),H.cachedUserData===null&&Re()}),xe(()=>{O()});let i=u(null),S=u(null),W=u("chip chip-default");async function Q(){var n;const t=await fetch(J+"/user-info/"+g,{method:"GET",headers:{Authorization:"Bearer "+K()}}),s=await t.json();t.ok&&(r(i,h(s)),r(W,h(e(i)&&(e(i).role==="OWNER"||e(i).role==="MODERATOR")?"chip chip-blue":e(i)&&e(i).role==="MEMBER"?"chip chip-yellow":"chip chip-default")),r(S,h(new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(s.creationDateTime))),r(P,h(((n=e(i))==null?void 0:n.followed)??!1)))}let P=u(!1),V=u(!1);var X=He(),Y=q(X);x(Y,()=>e(i),t=>{var s=Oe(),n=q(s),j=p(n,!0);c(n);var m=o(n,2);y(m,"gap","1rem");var b=p(m),w=p(b);Ue(w,{emoteId:"0",get userId(){return e(i).id}}),c(b);var A=o(b,2);y(A,"flex-grow","1");var F=p(A),z=p(F),ue=p(z,!0);c(z);var re=o(z,2);y(re,"color","grey");var ae=o(re,2),_e=p(ae);c(ae),c(F);var G=o(F,2),me=p(G);c(G);var oe=o(G,2);y(oe,"flex-grow","1");var ie=o(oe,2),R=p(ie),le=p(R),he=p(le,!0);c(le),c(R);var ne=o(R,2);y(ne,"flex-grow","1");var pe=o(ne,2);x(pe,()=>H.cachedUserData&&H.cachedUserData.id!==Number(g),je=>{var N=Le();N.__click=[Ce,i,V,P];var be=p(N,!0);c(N),ve(()=>{de(N,`${(e(P)?"follow-btn unfollow-btn":"follow-btn")??""} svelte-1jj7ebj`),N.disabled=e(V),$(be,e(P)?"Unfollow":"Follow")}),f(je,N)});var ge=o(pe,2);ge.__click=()=>{B()?U(D+"/home/report?reported="+g):U(D+"/account/login")},c(ie),c(A),c(m),ve(()=>{$(j,e(i).nickname),$(ue,e(i).username),$(_e,`Member since ${e(S)??""}`),$(me,`followers: ${e(i).followers??""}`),de(R,`${e(W)??""} svelte-1jj7ebj`),$(he,e(i).role)}),f(t,s)});var Z=o(Y,4);Ie(Z,17,()=>e(v),Ne,(t,s)=>{var n=Ae(),j=q(n);x(j,()=>e(s).post.replyTo,b=>{var w=Se();y(w,"margin","5px 0"),y(w,"color","grey"),f(b,w)});var m=o(j,2);De(m,{get post(){return e(s)},redirectOnClick:"true",replied:()=>{U(D+"/home/post/"+e(s).post.id)},ondelete:b=>{r(v,h(e(v).filter(w=>w.post.id!==b)))}}),f(t,n)});var ee=o(Z,2);x(ee,()=>e(I),t=>{var s=Fe();f(t,s)});var te=o(ee,2);x(te,()=>e(M)&&e(v).length!==0,t=>{var s=ze();f(t,s)});var se=o(te,2);x(se,()=>e(T),t=>{var s=Ge();f(t,s)});var fe=o(se,2);x(fe,()=>!e(I)&&e(M)&&e(v).length===0,t=>{var s=qe();f(t,s)}),f(l,X),ye()}ke(["click"]);export{nt as component};
