import{c as k,a as u,t as x}from"../chunks/disclose-version.7XzoFcgQ.js";import{p as q,f as P,a as B,i as d,s as l,c as i,j as e,t as L,k as m,r as p}from"../chunks/runtime.CcS7PSai.js";import{d as N,e as R}from"../chunks/render.CfWg8y1S.js";import{i as _}from"../chunks/if.Bc-vB0Lk.js";import{t as w,f as g}from"../chunks/index.D4VyEPYp.js";import{o as I}from"../chunks/index-client.DhXnJF1D.js";import{g as A}from"../chunks/entry.CftrLipe.js";import{P as O}from"../chunks/public.CuSQJZaf.js";import{E as T}from"../chunks/ErrorArticle.onCvV9Yg.js";import{i as U,j as Y,l as z}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";var F=x('<div><article><strong>Recover account</strong> <footer><form><label for="password">Current password</label> <input type="password" id="password" name="password" required> <hr> <label for="new-password">New password</label> <input type="password" id="new-password" name="new-password" required> <label for="new-password-confirm">Confirm new password</label> <input type="password" id="new-password-confirm" name="new-password-confirm" required> <button type="submit">Save changes</button></form> <!></footer></article></div>'),J=()=>{A("/account/login")},K=x('<article><strong>Password changed</strong> <footer><p>Your password has been changed successfully</p> <p>You will have to log back in for security purposes.</p> <button type="submit">Accept</button></footer></article>');function er(C,S){q(S,!0);let t=m(!1),c=m(""),v=m(0),b=m(!1);I(()=>{U()||A("/account/login",{replaceState:!0})});async function j(a){e(b,!0),a.preventDefault();const r=new FormData(a.target),s={password:r.get("password"),newPassword:r.get("new-password")};if(r.get("new-password")===r.get("new-password-confirm"))try{(await fetch(O+"/change-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+Y()},body:JSON.stringify(s)})).ok?(e(t,!1),e(v,1),z()):(e(c,"An error occurred."),e(t,!0))}catch{e(c,"Couldn't connect to the server."),e(t,!0)}else e(c,"Passwords do not match."),e(t,!0);e(b,!1)}var y=k(),D=P(y);_(D,()=>d(v)===0,a=>{var r=F(),s=i(r),n=l(i(s),2),o=i(n),f=l(i(o),14);p(o);var h=l(o,2);_(h,()=>d(t),E=>{T(E,{get text(){return d(c)},removeAction:()=>{e(t,!1)}})}),p(n),p(s),p(r),L(()=>f.disabled=d(b)),R("submit",o,j),w(1,r,()=>g,()=>({x:1e3,duration:500,delay:500})),w(2,r,()=>g,()=>({x:-1e3,duration:500})),u(a,r)},a=>{var r=k(),s=P(r);_(s,()=>d(v)===1,n=>{var o=K(),f=l(i(o),2),h=l(i(f),4);h.__click=[J],p(f),p(o),w(1,o,()=>g,()=>({x:1e3,duration:500,delay:500})),w(2,o,()=>g,()=>({x:-1e3,duration:500})),u(n,o)},null,!0),u(a,r)}),u(C,y),B()}N(["click"]);export{er as component};
