import{a as f,t as _}from"../chunks/disclose-version.7XzoFcgQ.js";import{h as pe,p as be,k as u,m as we,f as G,a as xe,j as r,i as e,s as o,c as p,r as c,t as ce}from"../chunks/runtime.CcS7PSai.js";import{d as ye,s as $}from"../chunks/render.CfWg8y1S.js";import{i as x}from"../chunks/if.Bc-vB0Lk.js";import{e as ke,i as Ie}from"../chunks/each.BmzqR-dK.js";import{s as y}from"../chunks/style.PwPRnE0L.js";import{p as m}from"../chunks/proxy.DTRB1kLB.js";import{s as Ne,a as $e}from"../chunks/store.BcBN-cJU.js";import{o as Me,g as U}from"../chunks/entry.PtJ6w72k.js";import{P as H}from"../chunks/public.CuSQJZaf.js";import{L as Te,F as Ue}from"../chunks/FeedPost.DcBA4ZlU.js";import{p as De}from"../chunks/stores.m6yhnLkY.js";import{o as Ee}from"../chunks/index-client.DhXnJF1D.js";import{i as R,c as Pe,j as J}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";import{s as q}from"../chunks/shared.svelte.MLCOWDAd.js";function ve(l,d){var k=l.__className,a=Re(d);pe&&l.className===a?l.__className=a:(k!==a||pe&&l.className!==a)&&(d==null?l.removeAttribute("class"):l.className=a,l.__className=a)}function Re(l){return l??""}async function Be(l,d,k,a){if(!e(d))return;r(k,!0),r(a,!e(a));const g={followed:e(a),userId:e(d).id};try{(await fetch(H+"/user/follow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+J()},body:JSON.stringify(g)})).ok?e(a)?e(d).followers+=1:e(d).followers-=1:r(a,!e(a))}catch{r(a,!e(a))}r(k,!1)}var Ce=_("<button> </button>"),Le=_('<h1> </h1> <div class="sbs svelte-1jj7ebj"><div class="lottie svelte-1jj7ebj"><!></div> <div class="user-details svelte-1jj7ebj"><div class="user-datetime svelte-1jj7ebj"><strong> </strong> <p class="svelte-1jj7ebj">&bull;</p> <p class="svelte-1jj7ebj"> </p></div> <p class="svelte-1jj7ebj"> </p> <div></div> <div class="sbs svelte-1jj7ebj"><div><p class="svelte-1jj7ebj"> </p></div> <div></div> <!> <button class="report-btn svelte-1jj7ebj" aria-label="Report user"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 14h14l-4.5 -4.5l4.5 -4.5h-14v16"></path></svg></button></div></div></div>',1),Oe=_("<p>In response to another post</p>"),Se=_("<!> <!>",1),Ae=_("<p>Loading...</p>"),Fe=_("<p>Reached end</p>"),ze=_("<p>Failed to load posts</p>"),Ge=_("<p>This user didn't post anything</p>"),qe=_("<!> <hr> <!> <!> <!> <!> <!>",1);function it(l,d){be(d,!0);const k=Ne();let g=$e(De,"$page",k).params.id,v=u(m([])),B=0,I=u(!1),M=u(!1),T=u(!1),D;async function C(){if(console.log("loadMore"),!(e(I)||e(M)||!R())){r(I,!0),r(T,!1);try{const t=await fetch(H+"/posts/"+g+`?page=${B}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+J()}});if(t.status!==200)r(T,!0);else{const s=await t.json();s.length!==0?(r(v,m([...e(v),...s])),B+=1):r(M,!0)}}catch{r(T,!0)}r(I,!1)}}function L(){if(D&&D.disconnect(),e(v).length>0){const t=document.querySelector(".post:last-child");t&&(D=new IntersectionObserver(s=>{s[0].isIntersecting&&C()}),D.observe(t))}}Me(t=>{var s,n,j,h;((s=t.to)==null?void 0:s.route.id)!=="/home/user/[id]"||((n=t.from)==null?void 0:n.route.id)!=="/home/user/[id]"||(g=((h=(j=t.to)==null?void 0:j.params)==null?void 0:h.id)??"-1",r(v,m([])),B=0,r(I,!1),r(M,!1),r(T,!1),r(i,null),r(O,null),R()||U("/account/login",{replaceState:!0}),C(),L(),W())}),Ee(()=>{R()||U("/account/login",{replaceState:!0}),C(),L(),W(),q.cachedUserData===null&&Pe()}),we(()=>{L()});let i=u(null),O=u(null),K=u("chip chip-default");async function W(){var n;const t=await fetch(H+"/user-info/"+g,{method:"GET",headers:{Authorization:"Bearer "+J()}}),s=await t.json();t.ok&&(r(i,m(s)),r(K,m(e(i)&&(e(i).role==="OWNER"||e(i).role==="MODERATOR")?"chip chip-blue":e(i)&&e(i).role==="MEMBER"?"chip chip-yellow":"chip chip-default")),r(O,m(new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(s.creationDateTime))),r(E,m(((n=e(i))==null?void 0:n.followed)??!1)))}let E=u(!1),Q=u(!1);var V=qe(),X=G(V);x(X,()=>e(i),t=>{var s=Le(),n=G(s),j=p(n,!0);c(n);var h=o(n,2);y(h,"gap","1rem");var b=p(h),w=p(b);Te(w,{emoteId:"0",get userId(){return e(i).id}}),c(b);var S=o(b,2);y(S,"flex-grow","1");var A=p(S),F=p(A),fe=p(F,!0);c(F);var se=o(F,2);y(se,"color","grey");var re=o(se,2),ue=p(re);c(re),c(A);var z=o(A,2),_e=p(z);c(z);var ae=o(z,2);y(ae,"flex-grow","1");var oe=o(ae,2),P=p(oe),ie=p(P),he=p(ie,!0);c(ie),c(P);var le=o(P,2);y(le,"flex-grow","1");var ne=o(le,2);x(ne,()=>q.cachedUserData&&q.cachedUserData.id!==Number(g),ge=>{var N=Ce();N.__click=[Be,i,Q,E];var je=p(N,!0);c(N),ce(()=>{ve(N,`${(e(E)?"follow-btn unfollow-btn":"follow-btn")??""} svelte-1jj7ebj`),N.disabled=e(Q),$(je,e(E)?"Unfollow":"Follow")}),f(ge,N)});var me=o(ne,2);me.__click=()=>{R()?U("/home/report?reported="+g):U("/account/login")},c(oe),c(S),c(h),ce(()=>{$(j,e(i).nickname),$(fe,e(i).username),$(ue,`Member since ${e(O)??""}`),$(_e,`followers: ${e(i).followers??""}`),ve(P,`${e(K)??""} svelte-1jj7ebj`),$(he,e(i).role)}),f(t,s)});var Y=o(X,4);ke(Y,17,()=>e(v),Ie,(t,s)=>{var n=Se(),j=G(n);x(j,()=>e(s).post.replyTo,b=>{var w=Oe();y(w,"margin","5px 0"),y(w,"color","grey"),f(b,w)});var h=o(j,2);Ue(h,{get post(){return e(s)},redirectOnClick:"true",replied:()=>{U("/home/post/"+e(s).post.id)},ondelete:b=>{r(v,m(e(v).filter(w=>w.post.id!==b)))}}),f(t,n)});var Z=o(Y,2);x(Z,()=>e(I),t=>{var s=Ae();f(t,s)});var ee=o(Z,2);x(ee,()=>e(M)&&e(v).length!==0,t=>{var s=Fe();f(t,s)});var te=o(ee,2);x(te,()=>e(T),t=>{var s=ze();f(t,s)});var de=o(te,2);x(de,()=>!e(I)&&e(M)&&e(v).length===0,t=>{var s=Ge();f(t,s)}),f(l,V),xe()}ye(["click"]);export{it as component};
