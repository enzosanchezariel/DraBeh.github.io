import{c as S,a as c,t as C}from"../chunks/disclose-version.D9m7xwQo.js";import{p as B,f as D,a as T,j as t,i as r,k as n,s as f,c as m,r as p,t as U}from"../chunks/runtime.DfkX_MRI.js";import{d as O,e as z}from"../chunks/render.C_RUzaBA.js";import{i as g}from"../chunks/if.Che8I7_Z.js";import{t as v,f as b}from"../chunks/index.BZ_PEADJ.js";import{p as j}from"../chunks/proxy.DjRACbVb.js";import{o as F}from"../chunks/index-client.D7pkVx_0.js";import{g as J}from"../chunks/entry.DrjQL-hL.js";import{b as K}from"../chunks/paths.Yc6EZHTJ.js";import{P as M}from"../chunks/public.CuSQJZaf.js";import{E as W}from"../chunks/ErrorArticle.DqpzrGdp.js";import{i as q,j as G}from"../chunks/jwtRetriever.svelte.DgyyIg0v.js";var H=C('<article><strong>Issue report</strong> <footer><form><label for="reason">Reason</label> <textarea name="reason" id="reason"></textarea> <button type="submit">Send</button></form> <!></footer></article>'),Q=()=>{history.back()},V=C('<article><strong>Report sent successfully</strong> <footer><p>Thank you for notifying us. We are sorry for the inconvenience.</p> <button type="submit">Accept</button></footer></article>');function lt(E,L){B(L,!0);let _=n(null),h=n(null);F(()=>{q()||J(K+"/account/login",{replaceState:!0});const o=new URLSearchParams(window.location.search);t(_,j(Number(o.get("reported")))),t(h,j(Number(o.get("postId"))))});let i=n(!1),y=n(""),x=n(!1),k=n(0);async function N(o){o.preventDefault(),t(x,!0);const A={reason:new FormData(o.target).get("reason"),reported:r(_),postId:r(h)?r(h):null};try{(await fetch(M+"/report",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+G()},body:JSON.stringify(A)})).ok?(t(i,!1),t(k,1)):(t(y,"An error occurred."),t(i,!0))}catch{t(y,"Couldn't connect to the server."),t(i,!0)}t(x,!1)}var R=S(),P=D(R);g(P,()=>r(_),o=>{var w=S(),A=D(w);g(A,()=>r(k)===0,l=>{var e=H(),u=f(m(e),2),s=m(u),a=f(m(s),4);p(s);var d=f(s,2);g(d,()=>r(i),I=>{W(I,{removeAction:()=>{t(i,!1)},get text(){return r(y)}})}),p(u),p(e),U(()=>a.disabled=r(x)),z("submit",s,N),v(1,e,()=>b,()=>({x:1e3,duration:500,delay:500})),v(2,e,()=>b,()=>({x:-1e3,duration:500})),c(l,e)},l=>{var e=S(),u=D(e);g(u,()=>r(k)===1,s=>{var a=V(),d=f(m(a),2),I=f(m(d),2);I.__click=[Q],p(d),p(a),v(1,a,()=>b,()=>({x:1e3,duration:500,delay:500})),v(2,a,()=>b,()=>({x:-1e3,duration:500})),c(s,a)},null,!0),c(l,e)}),c(o,w)}),c(E,R),T()}O(["click"]);export{lt as component};
