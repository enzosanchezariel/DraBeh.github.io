import{a as h,t as _}from"../chunks/disclose-version.CLVP8wdO.js";import{h as ne,p as je,k as f,m as be,g as $,a as we,j as a,i as e,s as o,c as p,r as v,t as ce}from"../chunks/runtime.OFQIcp2P.js";import{d as xe,s as N}from"../chunks/render.BVhLVIDF.js";import{i as w}from"../chunks/if.CxsERAfj.js";import{e as ye,i as ke}from"../chunks/each._uhWAVV4.js";import{s as x}from"../chunks/style.PwPRnE0L.js";import{p as u}from"../chunks/proxy.B9U5D_Zu.js";import{o as Ie}from"../chunks/index-client.DzRFANZT.js";import{o as Ne,g as y}from"../chunks/entry.DWCLflUO.js";import{P as q}from"../chunks/public.CHZCeYTi.js";import{L as Ue,F as Pe}from"../chunks/FeedPost.BLo8KtiD.js";import"../chunks/lottie.CvEQ06TD.js";import{i as D,c as Re,j as H}from"../chunks/jwtRetriever.svelte.eYKYCOXx.js";import{s as G}from"../chunks/shared.svelte.Crem28hc.js";import{b as k}from"../chunks/paths.BwddfpLl.js";function pe(l,d){var n=l.__className,r=Le(d);ne&&l.className===r?l.__className=r:(n!==r||ne&&l.className!==r)&&(d==null?l.removeAttribute("class"):l.className=r,l.__className=r)}function Le(l){return l??""}async function Me(l,d,n,r){if(!e(d))return;a(n,!0),a(r,!e(r));const U={followed:e(r),userId:e(d).id};try{(await fetch(q+"/user/follow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+H()},body:JSON.stringify(U)})).ok?e(r)?e(d).followers+=1:e(d).followers-=1:a(r,!e(r))}catch{a(r,!e(r))}a(n,!1)}var Se=_("<button> </button>"),Te=(l,d)=>{D()?y(k+"/home/report?reported="+e(d)):y(k+"/account/login")},De=_('<h1> </h1> <div class="sbs svelte-1jj7ebj"><div class="lottie svelte-1jj7ebj"><!></div> <div class="user-details svelte-1jj7ebj"><div class="user-datetime svelte-1jj7ebj"><strong> </strong> <p class="svelte-1jj7ebj">&bull;</p> <p class="svelte-1jj7ebj"> </p></div> <p class="svelte-1jj7ebj"> </p> <div></div> <div class="sbs svelte-1jj7ebj"><div><p class="svelte-1jj7ebj"> </p></div> <div></div> <!> <button class="report-btn svelte-1jj7ebj" aria-label="Report user"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 14h14l-4.5 -4.5l4.5 -4.5h-14v16"></path></svg></button></div></div></div>',1),Ee=_("<p>In response to another post</p>"),Be=_("<!> <!>",1),Ce=_("<p>Loading...</p>"),Oe=_("<p>Reached end</p>"),Ae=_("<p>Failed to load posts</p>"),Fe=_("<p>This user didn't post anything</p>"),ze=_("<!> <hr> <!> <!> <!> <!> <!>",1);function at(l,d){je(d,!0);let n=f(void 0),r=f(u([])),U=0,m=f(!1),P=f(!1),R=f(!1),M;async function E(){if(console.log("loadMore"),!(e(m)||e(P)||!D())){a(m,!0),a(R,!1);try{const t=await fetch(q+"/posts/"+e(n)+`?page=${U}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+H()}});if(t.status!==200)a(R,!0);else{const s=await t.json();s.length!==0?(a(r,u([...e(r),...s])),U+=1):a(P,!0)}}catch{a(R,!0)}a(m,!1)}}function B(){if(M&&M.disconnect(),e(r).length>0){const t=document.querySelector(".post:last-child");t&&(M=new IntersectionObserver(s=>{s[0].isIntersecting&&E()}),M.observe(t))}}Ne(t=>{var c,g;if(((c=t.to)==null?void 0:c.route.id)!=="/home/user"||((g=t.from)==null?void 0:g.route.id)!=="/home/user")return;const s=new URLSearchParams(window.location.search);a(n,u(s.get("userId"))),e(n)?(a(r,u([])),U=0,a(m,!1),a(P,!1),a(R,!1),a(i,null),a(C,null),D()||y(k+"/account/login",{replaceState:!0}),E(),B(),K()):y(k+"/home")}),Ie(()=>{const t=new URLSearchParams(window.location.search);a(n,u(t.get("userId"))),e(n)?(D()||y(k+"/account/login",{replaceState:!0}),E(),B(),K(),G.cachedUserData===null&&Re()):y(k+"/home")}),be(()=>{B()});let i=f(null),C=f(null),J=f("chip chip-default");async function K(){var c;const t=await fetch(q+"/user-info/"+e(n),{method:"GET",headers:{Authorization:"Bearer "+H()}}),s=await t.json();t.ok&&(a(i,u(s)),a(J,u(e(i)&&(e(i).role==="OWNER"||e(i).role==="MODERATOR")?"chip chip-blue":e(i)&&e(i).role==="MEMBER"?"chip chip-yellow":"chip chip-default")),a(C,u(new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(s.creationDateTime))),a(S,u(((c=e(i))==null?void 0:c.followed)??!1)))}let S=f(!1),W=f(!1);var Q=ze(),V=$(Q);w(V,()=>e(i),t=>{var s=De(),c=$(s),g=p(c,!0);v(c);var L=o(c,2);x(L,"gap","1rem");var j=p(L),b=p(j);Ue(b,{emoteId:"0",get userId(){return e(i).id}}),v(j);var O=o(j,2);x(O,"flex-grow","1");var A=p(O),F=p(A),de=p(F,!0);v(F);var te=o(F,2);x(te,"color","grey");var re=o(te,2),fe=p(re);v(re),v(A);var z=o(A,2),ue=p(z);v(z);var ae=o(z,2);x(ae,"flex-grow","1");var se=o(ae,2),T=p(se),oe=p(T),he=p(oe,!0);v(oe),v(T);var ie=o(T,2);x(ie,"flex-grow","1");var le=o(ie,2);w(le,()=>G.cachedUserData&&G.cachedUserData.id!==Number(e(n)),me=>{var I=Se();I.__click=[Me,i,W,S];var ge=p(I,!0);v(I),ce(()=>{pe(I,`${(e(S)?"follow-btn unfollow-btn":"follow-btn")??""} svelte-1jj7ebj`),I.disabled=e(W),N(ge,e(S)?"Unfollow":"Follow")}),h(me,I)});var _e=o(le,2);_e.__click=[Te,n],v(se),v(O),v(L),ce(()=>{N(g,e(i).nickname),N(de,e(i).username),N(fe,`Member since ${e(C)??""}`),N(ue,`followers: ${e(i).followers??""}`),pe(T,`${e(J)??""} svelte-1jj7ebj`),N(he,e(i).role)}),h(t,s)});var X=o(V,4);ye(X,17,()=>e(r),ke,(t,s)=>{var c=Be(),g=$(c);w(g,()=>e(s).post.replyTo,j=>{var b=Ee();x(b,"margin","5px 0"),x(b,"color","grey"),h(j,b)});var L=o(g,2);Pe(L,{get post(){return e(s)},redirectOnClick:"true",replied:()=>{y(k+"/home/post?postId="+e(s).post.id)},ondelete:j=>{a(r,u(e(r).filter(b=>b.post.id!==j)))}}),h(t,c)});var Y=o(X,2);w(Y,()=>e(m),t=>{var s=Ce();h(t,s)});var Z=o(Y,2);w(Z,()=>e(P)&&e(r).length!==0,t=>{var s=Oe();h(t,s)});var ee=o(Z,2);w(ee,()=>e(R),t=>{var s=Ae();h(t,s)});var ve=o(ee,2);w(ve,()=>!e(m)&&e(P)&&e(r).length===0,t=>{var s=Fe();h(t,s)}),h(l,Q),we()}xe(["click"]);export{at as component};
