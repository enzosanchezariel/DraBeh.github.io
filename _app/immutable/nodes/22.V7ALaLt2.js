import{c as S,a as c,t as C}from"../chunks/disclose-version.7XzoFcgQ.js";import{p as B,f as D,a as T,j as t,i as r,k as s,s as f,c as m,r as p,t as U}from"../chunks/runtime.CcS7PSai.js";import{d as O,e as z}from"../chunks/render.CfWg8y1S.js";import{i as g}from"../chunks/if.Bc-vB0Lk.js";import{t as v,f as b}from"../chunks/index.D4VyEPYp.js";import{p as j}from"../chunks/proxy.DTRB1kLB.js";import{o as F}from"../chunks/index-client.DhXnJF1D.js";import{g as J}from"../chunks/entry.CftrLipe.js";import{P as K}from"../chunks/public.CuSQJZaf.js";import{E as M}from"../chunks/ErrorArticle.onCvV9Yg.js";import{i as W,j as q}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";var G=C('<article><strong>Issue report</strong> <footer><form><label for="reason">Reason</label> <textarea name="reason" id="reason"></textarea> <button type="submit">Send</button></form> <!></footer></article>'),H=()=>{history.back()},Q=C('<article><strong>Report sent successfully</strong> <footer><p>Thank you for notifying us. We are sorry for the inconvenience.</p> <button type="submit">Accept</button></footer></article>');function st(E,L){B(L,!0);let _=s(null),h=s(null);F(()=>{W()||J("/account/login",{replaceState:!0});const o=new URLSearchParams(window.location.search);t(_,j(Number(o.get("reported")))),t(h,j(Number(o.get("postId"))))});let i=s(!1),y=s(""),x=s(!1),k=s(0);async function N(o){o.preventDefault(),t(x,!0);const A={reason:new FormData(o.target).get("reason"),reported:r(_),postId:r(h)?r(h):null};try{(await fetch(K+"/report",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+q()},body:JSON.stringify(A)})).ok?(t(i,!1),t(k,1)):(t(y,"An error occurred."),t(i,!0))}catch{t(y,"Couldn't connect to the server."),t(i,!0)}t(x,!1)}var R=S(),P=D(R);g(P,()=>r(_),o=>{var w=S(),A=D(w);g(A,()=>r(k)===0,l=>{var e=G(),u=f(m(e),2),n=m(u),a=f(m(n),4);p(n);var d=f(n,2);g(d,()=>r(i),I=>{M(I,{removeAction:()=>{t(i,!1)},get text(){return r(y)}})}),p(u),p(e),U(()=>a.disabled=r(x)),z("submit",n,N),v(1,e,()=>b,()=>({x:1e3,duration:500,delay:500})),v(2,e,()=>b,()=>({x:-1e3,duration:500})),c(l,e)},l=>{var e=S(),u=D(e);g(u,()=>r(k)===1,n=>{var a=Q(),d=f(m(a),2),I=f(m(d),2);I.__click=[H],p(d),p(a),v(1,a,()=>b,()=>({x:1e3,duration:500,delay:500})),v(2,a,()=>b,()=>({x:-1e3,duration:500})),c(n,a)},null,!0),c(l,e)}),c(o,w)}),c(E,R),T()}O(["click"]);export{st as component};
