import{c as G,a as _,t as z}from"../chunks/disclose-version.D9m7xwQo.js";import{p as ae,k as v,f as K,a as te,j as a,i as e,s as c,c as n,t as w,r as i}from"../chunks/runtime.DfkX_MRI.js";import{d as re,e as oe,s as ie}from"../chunks/render.C_RUzaBA.js";import{i as B}from"../chunks/if.Che8I7_Z.js";import{e as se,i as ne}from"../chunks/each.CjdCHN41.js";import{r as M,s as x}from"../chunks/attributes.Dy5-VJ7D.js";import{t as k,f as C}from"../chunks/index.BZ_PEADJ.js";import{b as le,a as ce}from"../chunks/input.DziYSjDK.js";import{p as E}from"../chunks/proxy.DjRACbVb.js";import{o as de}from"../chunks/index-client.D7pkVx_0.js";import{g as N}from"../chunks/entry.BIT9139B.js";import{b as Y}from"../chunks/paths.DkE6e-OB.js";import{P as S}from"../chunks/public.CuSQJZaf.js";import{E as pe}from"../chunks/ErrorArticle.DqpzrGdp.js";import{i as ve,c as ue,j as I}from"../chunks/jwtRetriever.svelte.DgyyIg0v.js";import{s as P}from"../chunks/shared.svelte.BeaxiWn1.js";var fe=z('<div class="avatar-option svelte-i63p4"><input type="radio" name="avatar" hidden class="svelte-i63p4"> <label class="avatar-label svelte-i63p4"><img class="svelte-i63p4"> <span class="svelte-i63p4"> </span></label></div>'),me=z('<div><article><strong>Select avatar</strong> <footer><form><div class="avatar-grid svelte-i63p4"></div> <hr> <label for="code">I have an avatar code</label> <input type="code" id="code" name="code"> <button type="submit">Apply</button></form> <!></footer></article></div>'),ge=()=>{N(Y+"/account/settings")},he=z('<article><strong>Avatar changed</strong> <footer><p>Your avatar has been changed successfully</p> <button type="submit">Accept</button></footer></article>');function Pe(q,H){ae(H,!0);const J=[];let f=v(!1),l=v(!1),m=v(""),j=v(0);de(async()=>{ve()||N(Y+"/account/login",{replaceState:!0}),await ue(),P.cachedUserData&&P.cachedUserData.avatarId&&a(b,E(P.cachedUserData.avatarId)),V()});async function Q(r){a(f,!0),r.preventDefault(),new FormData(r.target);try{let t;e(d)!==""&&e(d)!==null&&e(d)!==void 0?t=await fetch(S+"/change-avatar-key",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+I()},body:e(d)}):t=await fetch(S+"/change-avatar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+I()},body:e(b).toString()}),t.ok?(a(l,!1),a(j,1)):(a(m,"An error occurred."),a(l,!0))}catch{a(m,"Couldn't connect to the server."),a(l,!0)}a(f,!1)}let L=v(E([]));async function V(){a(f,!0);try{const r=await fetch(S+"/avatar/previews",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+I()}});r.ok?(a(L,E(await r.json())),a(f,!1),a(l,!1)):(a(m,"An error occurred."),a(l,!0))}catch{a(m,"Couldn't connect to the server."),a(l,!0)}}let b=v(0),d=v(null);var O=G(),W=K(O);B(W,()=>e(j)===0,r=>{var t=me(),y=n(t),A=c(n(y),2),o=n(A),u=n(o);se(u,21,()=>e(L),ne,(h,s)=>{var D=fe(),p=n(D);M(p),w(()=>x(p,"id",e(s).id.toString()));var R,T=c(p,2);w(()=>x(T,"for",e(s).id.toString()));var U=n(T),F=c(U,2),$=n(F,!0);i(F),i(T),i(D),w(()=>{R!==(R=e(s).id)&&(p.value=(p.__value=e(s).id)==null?"":e(s).id),p.disabled=e(d),x(U,"src",S+"/avatar/preview/"+e(s).id),x(U,"alt",e(s).name+" preview image"),ie($,e(s).name)}),ce(J,[],p,()=>(e(s).id,e(b)),ee=>a(b,ee)),_(h,D)}),i(u);var g=c(u,6);M(g);var X=c(g,2);i(o);var Z=c(o,2);B(Z,()=>e(l),h=>{pe(h,{get text(){return e(m)},removeAction:()=>{a(l,!1)}})}),i(A),i(y),i(t),w(()=>X.disabled=e(f)),oe("submit",o,Q),le(g,()=>e(d),h=>a(d,h)),k(1,t,()=>C,()=>({x:1e3,duration:500,delay:500})),k(2,t,()=>C,()=>({x:-1e3,duration:500})),_(r,t)},r=>{var t=G(),y=K(t);B(y,()=>e(j)===1,A=>{var o=he(),u=c(n(o),2),g=c(n(u),2);g.__click=[ge],i(u),i(o),k(1,o,()=>C,()=>({x:1e3,duration:500,delay:500})),k(2,o,()=>C,()=>({x:-1e3,duration:500})),_(A,o)},null,!0),_(r,t)}),_(q,O),te()}re(["click"]);export{Pe as component};
