import{a as u,t as h}from"../chunks/disclose-version.CLVP8wdO.js";import{h as ne,p as be,k as d,m as we,g as G,a as ke,j as s,i as e,s as o,c as v,r as p,t as ce}from"../chunks/runtime.OFQIcp2P.js";import{d as xe,s as U}from"../chunks/render.BVhLVIDF.js";import{i as x}from"../chunks/if.CxsERAfj.js";import{e as ye,i as Ie}from"../chunks/each._uhWAVV4.js";import{s as g}from"../chunks/style.PwPRnE0L.js";import{p as m}from"../chunks/proxy.B9U5D_Zu.js";import{o as Ne}from"../chunks/index-client.DzRFANZT.js";import{o as Ue,g as y}from"../chunks/entry.Bte1fv6N.js";import{P as q}from"../chunks/public.CHZCeYTi.js";import{L as Pe,F as Re}from"../chunks/FeedPost.BhsIE7cc.js";import{i as M,c as Le,j as H}from"../chunks/jwtRetriever.svelte.eYKYCOXx.js";import{s as J}from"../chunks/shared.svelte.Crem28hc.js";import{b as I}from"../chunks/paths.BHdTY2o9.js";function ve(i,f){var n=i.__className,a=Se(f);ne&&i.className===a?i.__className=a:(n!==a||ne&&i.className!==a)&&(f==null?i.removeAttribute("class"):i.className=a,i.__className=a)}function Se(i){return i??""}async function Te(i,f,n,a){if(!e(f))return;s(n,!0),s(a,!e(a));const P={followed:e(a),userId:e(f).id};try{(await fetch(q+"/user/follow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+H()},body:JSON.stringify(P)})).ok?e(a)?e(f).followers+=1:e(f).followers-=1:s(a,!e(a))}catch{s(a,!e(a))}s(n,!1)}var De=h("<button> </button>"),Ee=(i,f)=>{M()?y(I+"/home/report?reported="+e(f)):y(I+"/account/login")},Me=h('<h1 class="svelte-abfmk5"> </h1> <div class="sbs svelte-abfmk5"><div class="lottie svelte-abfmk5"><!></div> <div class="user-details svelte-abfmk5"><div class="user-datetime svelte-abfmk5"><strong class="svelte-abfmk5"> </strong> <p class="svelte-abfmk5">&bull;</p> <p class="svelte-abfmk5"> </p></div> <p class="svelte-abfmk5"> </p> <div></div> <div class="sbs svelte-abfmk5"><div><p class="svelte-abfmk5"> </p></div> <div></div> <!> <button class="report-btn svelte-abfmk5" aria-label="Report user"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 14h14l-4.5 -4.5l4.5 -4.5h-14v16"></path></svg></button></div></div></div>',1),je=h("<p>In response to another post</p>"),Be=h("<!> <!>",1),Ce=h("<p>Loading...</p>"),Oe=h("<p>Reached end</p>"),Ae=h("<p>Failed to load posts</p>"),Fe=h("<p>This user didn't post anything</p>"),ze=h("<!> <hr> <!> <!> <!> <!> <!>",1);function at(i,f){be(f,!0);let n=d(void 0),a=d(m([])),P=0,_=d(!1),R=d(!1),L=d(!1),T;async function j(){if(console.log("loadMore"),!(e(_)||e(R)||!M())){s(_,!0),s(L,!1);try{const t=await fetch(q+"/posts/"+e(n)+`?page=${P}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+H()}});if(t.status!==200)s(L,!0);else{const r=await t.json();r.length!==0?(s(a,m([...e(a),...r])),P+=1):s(R,!0)}}catch{s(L,!0)}s(_,!1)}}function B(){if(T&&T.disconnect(),e(a).length>0){const t=document.querySelector(".post:last-child");t&&(T=new IntersectionObserver(r=>{r[0].isIntersecting&&j()}),T.observe(t))}}Ue(t=>{var c,b;if(((c=t.to)==null?void 0:c.route.id)!=="/home/user"||((b=t.from)==null?void 0:b.route.id)!=="/home/user")return;const r=new URLSearchParams(window.location.search);s(n,m(r.get("userId"))),e(n)?(s(a,m([])),P=0,s(_,!1),s(R,!1),s(L,!1),s(l,null),s(C,null),M()||y(I+"/account/login",{replaceState:!0}),j(),B(),W()):y(I+"/home")}),Ne(()=>{const t=new URLSearchParams(window.location.search);s(n,m(t.get("userId"))),e(n)?(M()||y(I+"/account/login",{replaceState:!0}),j(),B(),W(),J.cachedUserData===null&&Le()):y(I+"/home")}),we(()=>{B()});let l=d(null),C=d(null),K=d("chip chip-default");async function W(){var c;const t=await fetch(q+"/user-info/"+e(n),{method:"GET",headers:{Authorization:"Bearer "+H()}}),r=await t.json();t.ok&&(s(l,m(r)),s(K,m(e(l)&&(e(l).role==="OWNER"||e(l).role==="MODERATOR")?"chip chip-blue":e(l)&&e(l).role==="MEMBER"?"chip chip-yellow":"chip chip-default")),s(C,m(new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(r.creationDateTime))),s(D,m(((c=e(l))==null?void 0:c.followed)??!1)))}let D=d(!1),Q=d(!1);var V=ze(),X=G(V);x(X,()=>e(l),t=>{var r=Me(),c=G(r),b=v(c,!0);p(c);var S=o(c,2);g(S,"gap","1rem");var w=v(S),k=v(w);Pe(k,{emoteId:"0",get avatarId(){return e(l).avatarId}}),p(w);var O=o(w,2);g(O,"flex-grow","1");var A=v(O),F=v(A),fe=v(F,!0);p(F);var z=o(F,2);g(z,"color","grey"),g(z,"flex-grow","0");var ae=o(z,2),de=v(ae);p(ae),p(A);var $=o(A,2),me=v($);p($);var se=o($,2);g(se,"flex-grow","1");var re=o(se,2),E=v(re),oe=v(E),ue=v(oe,!0);p(oe),p(E);var le=o(E,2);g(le,"flex-grow","1");var ie=o(le,2);x(ie,()=>J.cachedUserData&&J.cachedUserData.id!==Number(e(n)),_e=>{var N=De();N.__click=[Te,l,Q,D];var ge=v(N,!0);p(N),ce(()=>{ve(N,`${(e(D)?"follow-btn unfollow-btn":"follow-btn")??""} svelte-abfmk5`),N.disabled=e(Q),U(ge,e(D)?"Unfollow":"Follow")}),u(_e,N)});var he=o(ie,2);he.__click=[Ee,n],p(re),p(O),p(S),ce(()=>{U(b,e(l).nickname),U(fe,e(l).username),U(de,`Joined ${e(C)??""}`),U(me,`followers: ${e(l).followers??""}`),ve(E,`${e(K)??""} svelte-abfmk5`),U(ue,e(l).role)}),u(t,r)});var Y=o(X,4);ye(Y,17,()=>e(a),Ie,(t,r)=>{var c=Be(),b=G(c);x(b,()=>e(r).post.replyTo,w=>{var k=je();g(k,"margin","5px 0"),g(k,"color","grey"),u(w,k)});var S=o(b,2);Re(S,{get post(){return e(r)},redirectOnClick:"true",replied:()=>{y(I+"/home/post?postId="+e(r).post.id)},ondelete:w=>{s(a,m(e(a).filter(k=>k.post.id!==w)))}}),u(t,c)});var Z=o(Y,2);x(Z,()=>e(_),t=>{var r=Ce();u(t,r)});var ee=o(Z,2);x(ee,()=>e(R)&&e(a).length!==0,t=>{var r=Oe();u(t,r)});var te=o(ee,2);x(te,()=>e(L),t=>{var r=Ae();u(t,r)});var pe=o(te,2);x(pe,()=>!e(_)&&e(R)&&e(a).length===0,t=>{var r=Fe();u(t,r)}),u(i,V),ke()}xe(["click"]);export{at as component};
