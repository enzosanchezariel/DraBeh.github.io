import{a as s,t as l}from"../chunks/disclose-version.D9m7xwQo.js";import{p as G,k as i,m as O,f as T,a as V,j as o,i as a,s as n,c as $,l as q,r as K}from"../chunks/runtime.DfkX_MRI.js";import{i as c}from"../chunks/if.Che8I7_Z.js";import{e as N,i as S}from"../chunks/each.CjdCHN41.js";import{s as Y}from"../chunks/attributes.Dy5-VJ7D.js";import{p as f}from"../chunks/proxy.DjRACbVb.js";import{o as H}from"../chunks/index-client.D7pkVx_0.js";import{g as A}from"../chunks/entry.B_5C_Fe6.js";import{b as g}from"../chunks/paths.BDr6tJJm.js";import{P as B}from"../chunks/public.CuSQJZaf.js";import{P as J,F as Q}from"../chunks/FeedPost.CSrzYTt_.js";import{i as E,j as F}from"../chunks/jwtRetriever.svelte.DgyyIg0v.js";import{s as W}from"../chunks/shared.svelte.BeaxiWn1.js";var X=l('<article class="veryfy-account-banner svelte-bptypl"><a aria-label="Verify account" class="svelte-bptypl">Verify your account.</a> <p class="svelte-bptypl">Unverified accounts are deleted after a week (unless you have a membership or a special role).</p></article>'),Z=l("<p>Loading...</p>"),ee=l("<p>Reached end</p>"),te=l("<p>Failed to load posts</p>"),ae=l("<p>You came early to the party. Make a post!</p>"),oe=l("<!> <!> <!> <!> <!> <!> <!>",1);function ge(M,U){G(U,!0);let r=i(f([])),_=0,p=i(!1),d=i(!1),m=i(!1),v;async function y(){if(console.log("loadMore"),!(a(p)||a(d))){o(p,!0),o(m,!1);try{const e=await fetch(B+`/posts?page=${_}&size=5`,{method:"GET",headers:E()?{Authorization:"Bearer "+F()}:{}}),t=await e.json();e.status!==200?o(m,!0):t.length!==0?(o(r,f([...a(r),...t])),_+=1):o(d,!0)}catch{o(m,!0)}o(p,!1)}}function b(){if(v&&v.disconnect(),a(r).length>0){const e=document.querySelector(".post:last-child");e&&(v=new IntersectionObserver(t=>{t[0].isIntersecting&&y()}),v.observe(e))}}H(()=>{y(),b(),E()&&z()}),O(()=>{b()});let P=i(!1),u=i(null);async function z(){const e=await fetch(B+"/private-user-info",{method:"GET",headers:{Authorization:"Bearer "+F()}}),t=await e.json();e.ok&&(o(u,f(t.email)),o(P,f(t.activationCode)))}var w=oe(),k=T(w);c(k,()=>(a(P)||a(u)===null||a(u)==="")&&W.isLoggedIn,e=>{var t=X(),h=$(t);Y(h,"href",`${g??""}/account/verify-email`),q(2),K(t),s(e,t)});var L=n(k,2);J(L,{onsend:e=>{A(g+"/home/post/"+e)}});var j=n(L,2);N(j,17,()=>a(r),S,(e,t)=>{Q(e,{get post(){return a(t)},redirectOnClick:"true",replied:()=>{A(g+"/home/post/"+a(t).post.id)},ondelete:h=>{o(r,f(a(r).filter(D=>D.post.id!==h)))}})});var C=n(j,2);c(C,()=>a(p),e=>{var t=Z();s(e,t)});var I=n(C,2);c(I,()=>a(d)&&a(r).length!==0,e=>{var t=ee();s(e,t)});var x=n(I,2);c(x,()=>a(m),e=>{var t=te();s(e,t)});var R=n(x,2);c(R,()=>!a(p)&&a(d)&&a(r).length===0,e=>{var t=ae();s(e,t)}),s(M,w),V()}export{ge as component};
