import{c as G,a as _,t as z}from"../chunks/disclose-version.7XzoFcgQ.js";import{p as ee,k as v,f as K,a as te,j as t,i as e,s as c,c as n,t as w,r as i}from"../chunks/runtime.CcS7PSai.js";import{d as ae,e as re,s as oe}from"../chunks/render.CfWg8y1S.js";import{i as B}from"../chunks/if.Bc-vB0Lk.js";import{e as ie,i as se}from"../chunks/each.BmzqR-dK.js";import{r as M,s as x}from"../chunks/attributes.B2B5KGyN.js";import{t as k,f as C}from"../chunks/index.D4VyEPYp.js";import{b as ne,a as le}from"../chunks/input.RtaRc4WU.js";import{p as E}from"../chunks/proxy.DTRB1kLB.js";import{o as ce}from"../chunks/index-client.DhXnJF1D.js";import{g as N}from"../chunks/entry.CftrLipe.js";import{P as S}from"../chunks/public.CuSQJZaf.js";import{E as de}from"../chunks/ErrorArticle.onCvV9Yg.js";import{i as pe,c as ve,j as I}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";import{s as P}from"../chunks/shared.svelte.MLCOWDAd.js";var ue=z('<div class="avatar-option svelte-i63p4"><input type="radio" name="avatar" hidden class="svelte-i63p4"> <label class="avatar-label svelte-i63p4"><img class="svelte-i63p4"> <span class="svelte-i63p4"> </span></label></div>'),fe=z('<div><article><strong>Select avatar</strong> <footer><form><div class="avatar-grid svelte-i63p4"></div> <hr> <label for="code">I have an avatar code</label> <input type="code" id="code" name="code"> <button type="submit">Apply</button></form> <!></footer></article></div>'),me=()=>{N("/account/settings")},ge=z('<article><strong>Avatar changed</strong> <footer><p>Your avatar has been changed successfully</p> <button type="submit">Accept</button></footer></article>');function Ee(Y,q){ee(q,!0);const H=[];let f=v(!1),l=v(!1),m=v(""),j=v(0);ce(async()=>{pe()||N("/account/login",{replaceState:!0}),await ve(),P.cachedUserData&&P.cachedUserData.avatarId&&t(b,E(P.cachedUserData.avatarId)),Q()});async function J(r){t(f,!0),r.preventDefault(),new FormData(r.target);try{let a;e(d)!==""&&e(d)!==null&&e(d)!==void 0?a=await fetch(S+"/change-avatar-key",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+I()},body:e(d)}):a=await fetch(S+"/change-avatar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+I()},body:e(b).toString()}),a.ok?(t(l,!1),t(j,1)):(t(m,"An error occurred."),t(l,!0))}catch{t(m,"Couldn't connect to the server."),t(l,!0)}t(f,!1)}let L=v(E([]));async function Q(){t(f,!0);try{const r=await fetch(S+"/avatar/previews",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+I()}});r.ok?(t(L,E(await r.json())),t(f,!1),t(l,!1)):(t(m,"An error occurred."),t(l,!0))}catch{t(m,"Couldn't connect to the server."),t(l,!0)}}let b=v(0),d=v(null);var O=G(),V=K(O);B(V,()=>e(j)===0,r=>{var a=fe(),y=n(a),A=c(n(y),2),o=n(A),u=n(o);ie(u,21,()=>e(L),se,(h,s)=>{var D=ue(),p=n(D);M(p),w(()=>x(p,"id",e(s).id.toString()));var R,T=c(p,2);w(()=>x(T,"for",e(s).id.toString()));var U=n(T),F=c(U,2),Z=n(F,!0);i(F),i(T),i(D),w(()=>{R!==(R=e(s).id)&&(p.value=(p.__value=e(s).id)==null?"":e(s).id),p.disabled=e(d),x(U,"src",S+"/avatar/preview/"+e(s).id),x(U,"alt",e(s).name+" preview image"),oe(Z,e(s).name)}),le(H,[],p,()=>(e(s).id,e(b)),$=>t(b,$)),_(h,D)}),i(u);var g=c(u,6);M(g);var W=c(g,2);i(o);var X=c(o,2);B(X,()=>e(l),h=>{de(h,{get text(){return e(m)},removeAction:()=>{t(l,!1)}})}),i(A),i(y),i(a),w(()=>W.disabled=e(f)),re("submit",o,J),ne(g,()=>e(d),h=>t(d,h)),k(1,a,()=>C,()=>({x:1e3,duration:500,delay:500})),k(2,a,()=>C,()=>({x:-1e3,duration:500})),_(r,a)},r=>{var a=G(),y=K(a);B(y,()=>e(j)===1,A=>{var o=ge(),u=c(n(o),2),g=c(n(u),2);g.__click=[me],i(u),i(o),k(1,o,()=>C,()=>({x:1e3,duration:500,delay:500})),k(2,o,()=>C,()=>({x:-1e3,duration:500})),_(A,o)},null,!0),_(r,a)}),_(Y,O),te()}ae(["click"]);export{Ee as component};
