import{a as l,t as c}from"../chunks/disclose-version.D9m7xwQo.js";import{p as ne,k as u,m as pe,a as ie,i as t,j as s,s as r,c as n,r as p,t as H,l as le}from"../chunks/runtime.DfkX_MRI.js";import{d as ce,s as d}from"../chunks/render.C_RUzaBA.js";import{i as h}from"../chunks/if.Che8I7_Z.js";import{e as fe,i as ve}from"../chunks/each.CjdCHN41.js";import{s as T}from"../chunks/attributes.Dy5-VJ7D.js";import{s as de}from"../chunks/style.PwPRnE0L.js";import{p as w}from"../chunks/proxy.DjRACbVb.js";import{b as _e}from"../chunks/this.DJKLHHA1.js";import{o as me}from"../chunks/index-client.D7pkVx_0.js";import{g as j}from"../chunks/entry.B_5C_Fe6.js";import{b as _}from"../chunks/paths.BDr6tJJm.js";import{P as $}from"../chunks/public.CuSQJZaf.js";import{i as ue,j as M}from"../chunks/jwtRetriever.svelte.DgyyIg0v.js";import{s as N}from"../chunks/shared.svelte.BeaxiWn1.js";var he=(y,m,o)=>{m(t(o).id)},ge=c('<button class="svelte-1f0az4b">Approve</button>'),be=(y,m,o)=>{m(t(o).id)},Re=c('<div class="areport svelte-1f0az4b"><p class="svelte-1f0az4b"><strong>Reported:</strong> <a> </a></p> <p class="svelte-1f0az4b"><strong>Reporter:</strong> <a> </a></p> <p class="svelte-1f0az4b"><strong>Date:</strong> </p> <p class="svelte-1f0az4b"><strong>State:</strong> </p> <p class="svelte-1f0az4b"><strong>Reason:</strong> </p> <p class="svelte-1f0az4b"><strong>Post:</strong> <a> </a></p> <!> <button class="svelte-1f0az4b">Appeal</button> <hr></div>'),ze=c("<p>Loading...</p>"),De=c("<p>Reached end</p>"),xe=c("<p>Failed to load reports</p>"),we=c("<p>No reports</p>"),ye=c('<div class="container"><!> <!> <!> <!> <!></div>');function Ce(y,m){ne(m,!0),me(()=>{ue()?N.cachedUserData?N.cachedUserData.role==="OWNER"||N.cachedUserData.role==="MODERATOR"?(C(),R()):j(_+"/home",{replaceState:!0}):j(_+"/home",{replaceState:!0}):j(_+"/account/login",{replaceState:!0})});let o=u(w([])),g=0,i=u(!1),f=u(!1),v=u(!1),b;async function R(){if(!(t(i)||t(f))){s(i,!0),s(v,!1);try{const a=await fetch($+`/reports?page=${g}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+M()}}),e=await a.json();a.status!==200?s(v,!0):e.length!==0?(s(o,w([...t(o),...e])),g+=1):s(f,!0)}catch{s(v,!0)}s(i,!1)}}let z=u(void 0);function C(){b&&b.disconnect(),t(o).length>0&&t(z)&&(b=new IntersectionObserver(a=>{a[0].isIntersecting&&R()}),b.observe(t(z)))}pe(()=>{C()});function J(a){return new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(new Date(a))}async function Q(a){try{(await fetch($+"/approve-report/"+a,{method:"POST",headers:{Authorization:"Bearer "+M()}})).status===200&&(s(o,w([])),g=0,s(i,!1),s(f,!1),s(v,!1),R())}catch{}}async function X(a){try{(await fetch($+"/appeal-report/"+a,{method:"POST",headers:{Authorization:"Bearer "+M()}})).status===200&&(s(o,w([])),g=0,s(i,!1),s(f,!1),s(v,!1),R())}catch{}}var A=ye(),F=n(A);fe(F,17,()=>t(o),ve,(a,e)=>{var D=Re(),P=n(D),k=r(n(P),2),Z=n(k,!0);p(k),p(P);var I=r(P,2),O=r(n(I),2),ee=n(O,!0);p(O),p(I);var S=r(I,2),te=r(n(S));H(()=>d(te,` ${J(t(e).creationDate)??""}`)),p(S);var x=r(S,2),ae=r(n(x));p(x);var E=r(x,2),re=r(n(E));p(E);var U=r(E,2),B=r(n(U),2),se=n(B,!0);p(B),p(U);var W=r(U,2);h(W,()=>t(e).state!=="APPROVED",L=>{var q=ge();q.__click=[he,Q,e],l(L,q)});var oe=r(W,2);oe.__click=[be,X,e],le(2),p(D),_e(D,L=>s(z,L),()=>t(z)),H(()=>{T(k,"href",_+"/home/user/"+t(e).reported),d(Z,t(e).reported),T(O,"href",_+(t(e).reporter?"/home/user/"+t(e).reporter:"#")),d(ee,t(e).reporter),de(x,"color",t(e).state==="APPROVED"?"red":"black"),d(ae,` ${t(e).state??""}`),d(re,` ${t(e).reason??""}`),T(B,"href",_+(t(e).postId?"/home/post/"+t(e).postId:"#")),d(se,t(e).postId)}),l(a,D)});var V=r(F,2);h(V,()=>t(i),a=>{var e=ze();l(a,e)});var G=r(V,2);h(G,()=>t(f)&&t(o).length!==0,a=>{var e=De();l(a,e)});var K=r(G,2);h(K,()=>t(v),a=>{var e=xe();l(a,e)});var Y=r(K,2);h(Y,()=>!t(i)&&t(f)&&t(o).length===0,a=>{var e=we();l(a,e)}),p(A),l(y,A),ie()}ce(["click"]);export{Ce as component};
