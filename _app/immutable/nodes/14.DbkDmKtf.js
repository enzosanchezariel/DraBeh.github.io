import{c as O,a as f,t as A}from"../chunks/disclose-version.7XzoFcgQ.js";import{p as X,f as R,a as Z,j as t,i as e,s as o,c as v,t as $,k as l,r as d}from"../chunks/runtime.CcS7PSai.js";import{d as ee,e as q}from"../chunks/render.CfWg8y1S.js";import{i as _}from"../chunks/if.Bc-vB0Lk.js";import{r as V}from"../chunks/attributes.B2B5KGyN.js";import{t as k,f as j,s as F}from"../chunks/index.D4VyEPYp.js";import{b as G}from"../chunks/input.RtaRc4WU.js";import{p as w}from"../chunks/proxy.DTRB1kLB.js";import{o as te}from"../chunks/index-client.DhXnJF1D.js";import{g as I}from"../chunks/entry.CftrLipe.js";import{P as H}from"../chunks/public.CuSQJZaf.js";import{E as ae}from"../chunks/ErrorArticle.onCvV9Yg.js";import{i as re,j as J,l as oe}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";var ne=A('<p class="svelte-vevk28">How you want to be called</p>'),se=A('<p class="svelte-vevk28">Unique to identify your account (cannot contain spaces)</p>'),ie=A('<article><strong>Change names</strong> <footer><form><div class="tip svelte-vevk28"><label for="nickname">Nickname</label> <input type="text" id="nickname" name="nickname" required class="svelte-vevk28"> <!></div> <div class="tip svelte-vevk28"><label for="username">Username</label> <input type="text" id="username" name="username" required class="svelte-vevk28"> <!></div> <button type="submit">Save changes</button></form> <!></footer></article>'),le=A("<p>You will have to log back in for security purposes.</p>"),ce=(L,D,c)=>{e(D)!==e(c)?I("/account/login"):I("/account/settings")},ue=A('<article><strong>Changes applied</strong> <footer><p>Changes applied successfully.</p> <!> <button type="submit">Accept</button></footer></article>');function Ae(L,D){X(D,!0);let c=l(!1),C=l(""),E=l(!1),U=l(-1),B=l(0);function N(r){t(U,w(r))}let u=l(""),y=l("");te(()=>{re()||I("/account/login",{replaceState:!0}),M()});async function K(r){t(E,!0),r.preventDefault();const a=new FormData(r.target),m={username:a.get("username"),nickname:a.get("nickname")};try{const n=await fetch(H+"/modify-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+J()},body:JSON.stringify(m)});n.ok?(t(c,!1),m.username!==e(b)&&oe(),t(B,1)):n.status===409?(t(C,"The username is already taken."),t(c,!0)):(t(C,"An error occurred."),t(c,!0))}catch{t(C,"Couldn't connect to the server."),t(c,!0)}t(E,!1)}let b=l(""),P=l("");async function M(){const r=await fetch(H+"/private-user-info",{method:"GET",headers:{Authorization:"Bearer "+J()}}),a=await r.json();r.ok&&(t(b,w(a.username)),t(P,w(a.nickname)),t(u,w(a.username)),t(y,w(a.nickname)))}var z=O(),Y=R(z);_(Y,()=>e(B)===0,r=>{var a=ie(),m=o(v(a),2),n=v(m),s=v(n),p=o(v(s),2);V(p);var S=o(p,2);_(S,()=>e(U)===0,i=>{var x=ne();k(3,x,()=>F,()=>({axis:"y",duration:500})),f(i,x)}),d(s);var h=o(s,2),g=o(v(h),2);V(g);var T=o(g,2);_(T,()=>e(U)===1,i=>{var x=se();k(3,x,()=>F,()=>({axis:"y",duration:500})),f(i,x)}),d(h);var Q=o(h,2);$(()=>Q.disabled=e(E)||e(u)===""||e(u).includes(" ")||e(y)===""||e(u)===e(b)&&e(y)===e(P)),d(n);var W=o(n,2);_(W,()=>e(c),i=>{ae(i,{get text(){return e(C)},removeAction:()=>{t(c,!1)}})}),d(m),d(a),q("submit",n,K),q("focus",p,()=>N(0)),G(p,()=>e(y),i=>t(y,i)),q("focus",g,()=>N(1)),G(g,()=>e(u),i=>t(u,i)),k(1,a,()=>j,()=>({x:1e3,duration:500,delay:500})),k(2,a,()=>j,()=>({x:-1e3,duration:500})),f(r,a)},r=>{var a=O(),m=R(a);_(m,()=>e(B)===1,n=>{var s=ue(),p=o(v(s),2),S=o(v(p),2);_(S,()=>e(u)!==e(b),g=>{var T=le();f(g,T)});var h=o(S,2);h.__click=[ce,u,b],d(p),d(s),k(1,s,()=>j,()=>({x:1e3,duration:500,delay:500})),k(2,s,()=>j,()=>({x:-1e3,duration:500})),f(n,s)},null,!0),f(r,a)}),f(L,z),Z()}ee(["click"]);export{Ae as component};
