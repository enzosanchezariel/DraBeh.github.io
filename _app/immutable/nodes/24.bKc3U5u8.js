import{a as l,t as c}from"../chunks/disclose-version.7XzoFcgQ.js";import{p as oe,k as m,m as ne,a as pe,i as t,j as s,s as r,c as n,r as p,t as q,l as ie}from"../chunks/runtime.CcS7PSai.js";import{d as le,s as d}from"../chunks/render.CfWg8y1S.js";import{i as u}from"../chunks/if.Bc-vB0Lk.js";import{e as ce,i as fe}from"../chunks/each.BmzqR-dK.js";import{s as L}from"../chunks/attributes.B2B5KGyN.js";import{s as ve}from"../chunks/style.PwPRnE0L.js";import{p as x}from"../chunks/proxy.DTRB1kLB.js";import{b as de}from"../chunks/this.4CFQ3K0D.js";import{o as _e}from"../chunks/index-client.DhXnJF1D.js";import{g as T}from"../chunks/entry.PtJ6w72k.js";import{P as j}from"../chunks/public.CuSQJZaf.js";import{i as me,j as $}from"../chunks/jwtRetriever.svelte.D-u_pXbS.js";import{s as M}from"../chunks/shared.svelte.MLCOWDAd.js";var ue=(w,_,o)=>{_(t(o).id)},he=c('<button class="svelte-1f0az4b">Approve</button>'),ge=(w,_,o)=>{_(t(o).id)},be=c('<div class="areport svelte-1f0az4b"><p class="svelte-1f0az4b"><strong>Reported:</strong> <a> </a></p> <p class="svelte-1f0az4b"><strong>Reporter:</strong> <a> </a></p> <p class="svelte-1f0az4b"><strong>Date:</strong> </p> <p class="svelte-1f0az4b"><strong>State:</strong> </p> <p class="svelte-1f0az4b"><strong>Reason:</strong> </p> <p class="svelte-1f0az4b"><strong>Post:</strong> <a> </a></p> <!> <button class="svelte-1f0az4b">Appeal</button> <hr></div>'),Re=c("<p>Loading...</p>"),ze=c("<p>Reached end</p>"),De=c("<p>Failed to load reports</p>"),xe=c("<p>No reports</p>"),we=c('<div class="container"><!> <!> <!> <!> <!></div>');function Me(w,_){oe(_,!0),_e(()=>{me()?M.cachedUserData?M.cachedUserData.role==="OWNER"||M.cachedUserData.role==="MODERATOR"?(N(),b()):T("/home",{replaceState:!0}):T("/home",{replaceState:!0}):T("/account/login",{replaceState:!0})});let o=m(x([])),h=0,i=m(!1),f=m(!1),v=m(!1),g;async function b(){if(!(t(i)||t(f))){s(i,!0),s(v,!1);try{const a=await fetch(j+`/reports?page=${h}&size=5`,{method:"GET",headers:{Authorization:"Bearer "+$()}}),e=await a.json();a.status!==200?s(v,!0):e.length!==0?(s(o,x([...t(o),...e])),h+=1):s(f,!0)}catch{s(v,!0)}s(i,!1)}}let R=m(void 0);function N(){g&&g.disconnect(),t(o).length>0&&t(R)&&(g=new IntersectionObserver(a=>{a[0].isIntersecting&&b()}),g.observe(t(R)))}ne(()=>{N()});function H(a){return new Intl.DateTimeFormat("en-US",{dateStyle:"short"}).format(new Date(a))}async function J(a){try{(await fetch(j+"/approve-report/"+a,{method:"POST",headers:{Authorization:"Bearer "+$()}})).status===200&&(s(o,x([])),h=0,s(i,!1),s(f,!1),s(v,!1),b())}catch{}}async function Q(a){try{(await fetch(j+"/appeal-report/"+a,{method:"POST",headers:{Authorization:"Bearer "+$()}})).status===200&&(s(o,x([])),h=0,s(i,!1),s(f,!1),s(v,!1),b())}catch{}}var y=we(),C=n(y);ce(C,17,()=>t(o),fe,(a,e)=>{var z=be(),A=n(z),P=r(n(A),2),Y=n(P,!0);p(P),p(A);var k=r(A,2),I=r(n(k),2),Z=n(I,!0);p(I),p(k);var O=r(k,2),ee=r(n(O));q(()=>d(ee,` ${H(t(e).creationDate)??""}`)),p(O);var D=r(O,2),te=r(n(D));p(D);var S=r(D,2),ae=r(n(S));p(S);var E=r(S,2),U=r(n(E),2),re=n(U,!0);p(U),p(E);var K=r(E,2);u(K,()=>t(e).state!=="APPROVED",B=>{var W=he();W.__click=[ue,J,e],l(B,W)});var se=r(K,2);se.__click=[ge,Q,e],ie(2),p(z),de(z,B=>s(R,B),()=>t(R)),q(()=>{L(P,"href","/home/user/"+t(e).reported),d(Y,t(e).reported),L(I,"href",t(e).reporter?"/home/user/"+t(e).reporter:"#"),d(Z,t(e).reporter),ve(D,"color",t(e).state==="APPROVED"?"red":"black"),d(te,` ${t(e).state??""}`),d(ae,` ${t(e).reason??""}`),L(U,"href",t(e).postId?"/home/post/"+t(e).postId:"#"),d(re,t(e).postId)}),l(a,z)});var F=r(C,2);u(F,()=>t(i),a=>{var e=Re();l(a,e)});var V=r(F,2);u(V,()=>t(f)&&t(o).length!==0,a=>{var e=ze();l(a,e)});var G=r(V,2);u(G,()=>t(v),a=>{var e=De();l(a,e)});var X=r(G,2);u(X,()=>!t(i)&&t(f)&&t(o).length===0,a=>{var e=xe();l(a,e)}),p(y),l(w,y),pe()}le(["click"]);export{Me as component};
