import{c as S,a as r,t as i}from"../chunks/disclose-version.CLVP8wdO.js";import{p as Y,k as f,m as Z,g as u,a as ee,i as e,j as t,s as w,l as te,c as oe,r as ae}from"../chunks/runtime.OFQIcp2P.js";import{i as d}from"../chunks/if.CxsERAfj.js";import{e as re,i as se}from"../chunks/each._uhWAVV4.js";import{p as v}from"../chunks/proxy.B9U5D_Zu.js";import{o as ne}from"../chunks/index-client.DzRFANZT.js";import{P as G}from"../chunks/public.CHZCeYTi.js";import{F as O}from"../chunks/FeedPost.Dq1CLr13.js";import{o as ie,g as j}from"../chunks/entry.JVcXWMU4.js";import{i as $,j as H}from"../chunks/jwtRetriever.svelte.eYKYCOXx.js";import{b as R}from"../chunks/paths.Dxl4Naed.js";var le=i("<p>Post not found</p>"),me=i("<p>Loading post...</p>"),pe=i("<p>Failed to load post</p>"),fe=i('<h3>Replying to</h3> <!> <div class="vertical-line svelte-10uk3rb"></div>',1),de=i("<!> <!>",1),ce=i('<div class="comment"><!></div>'),ue=i("<p>No comments</p>"),ve=i("<hr> <h3>Comments</h3> <!> <!>",1),_e=i("<p>Loading comments...</p>"),he=i("<p>Failed to load comments</p>"),ge=i("<!> <!> <!>",1);function xe(J,Q){Y(Q,!0);let _,l=f(v([])),U=0,y=f(!1),k=f(!1),C=f(!1);async function z(){if(console.log("loadMore"),!(e(y)||e(k))){t(y,!0),t(C,!1);try{const o=await fetch(G+"/posts/comments/"+_+`?page=${U}&size=5`,{method:"GET",headers:$()?{Authorization:"Bearer "+H()}:{}}),a=await o.json();o.status!==200?t(C,!0):a.length!==0?(t(l,v([...e(l),...a])),U+=1):t(k,!0)}catch{t(C,!0)}t(y,!1)}}let F;function A(){if(F&&F.disconnect(),e(l).length>0){const o=document.querySelector(".comment:last-child");o&&(F=new IntersectionObserver(a=>{a[0].isIntersecting&&z()}),F.observe(o))}}ne(()=>{_=new URLSearchParams(window.location.search).get("postId"),_||j(R+"/home"),q(),e(B)||(z(),A())}),ie(o=>{var L,b;if(((L=o.to)==null?void 0:L.route.id)!=="/home/post"||((b=o.from)==null?void 0:b.route.id)!=="/home/post")return;_=new URLSearchParams(window.location.search).get("postId"),_?(t(s,null),t(E,null),t(P,!1),t(x,!1),t(l,v([])),U=0,t(y,!1),t(k,!1),t(C,!1),q(),e(B)||(z(),A())):j(R+"/home")}),Z(()=>{A()});let x=f(!0),P=f(!1),B=f(!1),s=f(null),E=f(null);async function q(){t(x,!0),t(P,!1);try{const o=await fetch(G+"/post/"+_,{method:"GET",headers:$()?{Authorization:"Bearer "+H()}:{}});o.status!==200?(t(P,!0),o.status===404&&t(B,!0)):t(s,v(await o.json()))}catch{t(P,!0)}t(x,!1),e(s)&&e(s).post.replyTo&&t(E,v(await D(e(s).post.replyTo)))}async function V(o){const a=await D(o);a&&t(l,v([a,...e(l)]))}async function D(o){const a=await fetch(G+"/post/"+o);return a.status===200?a.json():null}var K=S(),W=u(K);d(W,()=>e(B),o=>{var a=le();r(o,a)},o=>{var a=ge(),L=u(a);d(L,()=>e(x),p=>{var n=me();r(p,n)},p=>{var n=S(),h=u(n);d(h,()=>e(P)||e(s)===null,c=>{var m=pe();r(c,m)},c=>{var m=de(),g=u(m);d(g,()=>e(s).post.replyTo&&e(E),T=>{var N=fe(),M=w(u(N),2);O(M,{get post(){return e(E)},redirectOnClick:"true",replied:()=>{e(s)&&e(s).post.replyTo&&j(R+"/home/post?postId="+e(s).post.replyTo)},ondelete:()=>{j(R+"/home")}}),te(2),r(T,N)});var I=w(g,2);O(I,{get post(){return e(s)},replied:T=>{V(T)},ondelete:()=>{j(R+"/home")}}),r(c,m)},!0),r(p,n)});var b=w(L,2);d(b,()=>e(s)&&e(s).post.replyTo===null,p=>{var n=ve(),h=w(u(n),4);re(h,17,()=>e(l),se,(m,g)=>{var I=ce(),T=oe(I);O(T,{get post(){return e(g)},ondelete:N=>{t(l,v(e(l).filter(M=>M.post.id!==N)))}}),ae(I),r(m,I)});var c=w(h,2);d(c,()=>e(l).length===0,m=>{var g=ue();r(m,g)}),r(p,n)});var X=w(b,2);d(X,()=>e(y),p=>{var n=_e();r(p,n)},p=>{var n=S(),h=u(n);d(h,()=>e(C),c=>{var m=he();r(c,m)},null,!0),r(p,n)}),r(o,a)}),r(J,K),ee()}export{xe as component};
