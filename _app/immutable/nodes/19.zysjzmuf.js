import{a as s,t as l}from"../chunks/disclose-version.CLVP8wdO.js";import{p as G,k as i,m as O,g as T,a as V,j as o,i as a,s as n,c as $,l as q,r as K}from"../chunks/runtime.OFQIcp2P.js";import{i as c}from"../chunks/if.CxsERAfj.js";import{e as N,i as S}from"../chunks/each._uhWAVV4.js";import{s as Y}from"../chunks/attributes.CGWwtoYz.js";import{p as f}from"../chunks/proxy.B9U5D_Zu.js";import{o as H}from"../chunks/index-client.DzRFANZT.js";import{g as A}from"../chunks/entry.DMoyRBBC.js";import{b as h}from"../chunks/paths.CWjIHuvM.js";import{P as B}from"../chunks/public.CHZCeYTi.js";import{P as J,F as Q}from"../chunks/FeedPost.C_lPGEKA.js";import{i as E,j as F}from"../chunks/jwtRetriever.svelte.eYKYCOXx.js";import{s as W}from"../chunks/shared.svelte.Crem28hc.js";var X=l('<article class="veryfy-account-banner svelte-bptypl"><a aria-label="Verify account" class="svelte-bptypl">Verify your account.</a> <p class="svelte-bptypl">Unverified accounts are deleted after a week (unless you have a membership or a special role).</p></article>'),Z=l("<p>Loading...</p>"),ee=l("<p>Reached end</p>"),te=l("<p>Failed to load posts</p>"),ae=l("<p>You came early to the party. Make a post!</p>"),oe=l("<!> <!> <!> <!> <!> <!> <!>",1);function ge(M,U){G(U,!0);let r=i(f([])),g=0,p=i(!1),d=i(!1),m=i(!1),v;async function _(){if(console.log("loadMore"),!(a(p)||a(d))){o(p,!0),o(m,!1);try{const e=await fetch(B+`/posts?page=${g}&size=5`,{method:"GET",headers:E()?{Authorization:"Bearer "+F()}:{}}),t=await e.json();e.status!==200?o(m,!0):t.length!==0?(o(r,f([...a(r),...t])),g+=1):o(d,!0)}catch{o(m,!0)}o(p,!1)}}function y(){if(v&&v.disconnect(),a(r).length>0){const e=document.querySelector(".post:last-child");e&&(v=new IntersectionObserver(t=>{t[0].isIntersecting&&_()}),v.observe(e))}}H(()=>{_(),y(),E()&&z()}),O(()=>{y()});let b=i(!1),P=i("");async function z(){const e=await fetch(B+"/private-user-info",{method:"GET",headers:{Authorization:"Bearer "+F()}}),t=await e.json();e.ok&&(o(P,f(t.email)),o(b,f(t.activationCode)))}var w=oe(),I=T(w);c(I,()=>(a(b)||a(P)===null)&&W.isLoggedIn,e=>{var t=X(),u=$(t);Y(u,"href",`${h??""}/account/verify-email`),q(2),K(t),s(e,t)});var k=n(I,2);J(k,{onsend:e=>{A(h+"/home/post?postId="+e)}});var L=n(k,2);N(L,17,()=>a(r),S,(e,t)=>{Q(e,{get post(){return a(t)},redirectOnClick:"true",replied:()=>{A(h+"/home/post?postId="+a(t).post.id)},ondelete:u=>{o(r,f(a(r).filter(D=>D.post.id!==u)))}})});var j=n(L,2);c(j,()=>a(p),e=>{var t=Z();s(e,t)});var C=n(j,2);c(C,()=>a(d)&&a(r).length!==0,e=>{var t=ee();s(e,t)});var x=n(C,2);c(x,()=>a(m),e=>{var t=te();s(e,t)});var R=n(x,2);c(R,()=>!a(p)&&a(d)&&a(r).length===0,e=>{var t=ae();s(e,t)}),s(M,w),V()}export{ge as component};
